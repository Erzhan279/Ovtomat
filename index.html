<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UaqytAI - iOS Login</title>
    <style>
        /* --- iOS 16 GLASSMORPHISM –°–¢–ò–õ–Ü --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(130deg, #ff7eb3, #ff758c, #4286f4, #34e89e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .glass-container {
            background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.5); padding: 30px; width: 100%; max-width: 420px; text-align: center; color: #1d1d1f;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo { font-size: 28px; font-weight: 800; background: linear-gradient(to right, #007AFF, #5AC8FA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .balance-badge { background: rgba(255, 255, 255, 0.5); padding: 8px 16px; border-radius: 20px; font-weight: 600; color: #007AFF; }
        
        input, textarea { width: 100%; padding: 16px; border-radius: 15px; border: none; background: rgba(255, 255, 255, 0.5); margin-bottom: 15px; box-sizing: border-box; transition: 0.3s; }
        input:focus, textarea:focus { outline: none; background: rgba(255, 255, 255, 0.8); box-shadow: 0 4px 15px rgba(0, 122, 255, 0.2); }
        
        .btn { background: linear-gradient(135deg, #007AFF, #00C6FF); color: white; border: none; padding: 16px; border-radius: 15px; font-weight: 700; width: 100%; cursor: pointer; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid #007AFF; color: #007AFF; box-shadow: none; }
        .btn-google { background: white; color: #333; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .divider { margin: 20px 0; color: #888; font-size: 14px; }
        .forgot-link { display: block; margin-bottom: 20px; font-size: 14px; color: #007AFF; text-decoration: none; cursor: pointer; }
        .forgot-link:hover { text-decoration: underline; }
        
        #resultImage { width: 100%; border-radius: 22px; margin-top: 20px; display: none; border: 4px solid rgba(255,255,255,0.5); }
    </style>
</head>
<body>

    <div class="glass-container">
        <div class="header">
            <div class="logo">UaqytAI</div>
            <div id="userInfo" style="display: none;">
                <span class="balance-badge">üí∞ <span id="balance">0</span> ‚Ç∏</span>
            </div>
        </div>

        <div id="loginSection">
            <h2>“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑! üëã</h2>
            
            <input type="email" id="emailInput" placeholder="Email (–ü–æ—à—Ç–∞“£—ã–∑)">
            <input type="password" id="passInput" placeholder="“ö“±–ø–∏—è —Å”©–∑ (–ü–∞—Ä–æ–ª—å)">
            
            <a id="forgotBtn" class="forgot-link">–ü–∞—Ä–æ–ª—å–¥—ñ “±–º—ã—Ç—Ç—ã“£—ã–∑ –±–∞?</a>
            
            <button id="loginBtn" class="btn">–ö—ñ—Ä—É</button>
            <button id="registerBtn" class="btn btn-outline">–¢—ñ—Ä–∫–µ–ª—É</button>

            <div class="divider">- –ù–ï–ú–ï–°–ï -</div>

            <button id="googleBtn" class="btn btn-google">
                <svg width="20" height="20" viewBox="0 0 24 24"><path d="M21.35,11.1H12v3.8h5.6c-0.6,2.3-2.5,3.6-4.9,3.6c-3.3,0-6-2.5-6-5.7s2.8-5.7,6-5.7c1.5,0,2.8,0.5,3.8,1.4l2.8-2.8C17.6,3.8,15,2.9,12,2.9c-5.2,0-9.4,4-9.4,9c0,5,4.2,9,9.4,9c5.1,0,9.1-3.4,9.1-8.5C21.1,11.8,21.35,11.1,21.35,11.1z" fill="#4285F4"/></svg>
                Google –∞—Ä“õ—ã–ª—ã
            </button>
        </div>

        <div id="appSection" style="display: none; text-align: left;">
            <label style="font-weight: 600; display: block; margin-bottom: 12px; margin-left: 5px;">–ü—Ä–æ–º–ø—Ç –∂–∞–∑—ã“£—ã–∑:</label>
            <textarea id="promptInput" placeholder="–ú—ã—Å–∞–ª—ã: –ë–æ–ª–∞—à–∞“õ—Ç–∞“ì—ã –ê–ª–º–∞—Ç—ã “õ–∞–ª–∞—Å—ã, “±—à–∞—Ç—ã–Ω –∫”©–ª—ñ–∫—Ç–µ—Ä..."></textarea>
            
            <button id="generateBtn" class="btn">–°—É—Ä–µ—Ç –∂–∞—Å–∞—É (5 —Ç–µ“£–≥–µ)</button>

            <div style="text-align: center;">
                <p id="loader" style="display:none; color:#007AFF; font-weight:bold;">–ñ–∞—Å–∞–Ω–¥—ã –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∂“±–º—ã—Å —ñ—Å—Ç–µ—É–¥–µ... üé®</p>
                <img id="resultImage" src="" alt="–ù”ô—Ç–∏–∂–µ">
            </div>

            <button onclick="logout()" class="btn" style="background: rgba(255,59,48,0.1); color: #FF3B30; margin-top:15px; box-shadow: none;">–®—ã“ì—É</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- –°–ï–ù –ñ–Ü–ë–ï–†–ì–ï–ù –ö–Ü–õ–¢–¢–ï–† ---
        const firebaseConfig = {
          apiKey: "AIzaSyBbeFirznnz99cwv1DVIroQj5ZBSM-knlY",
          authDomain: "uaqytai-ecc62.firebaseapp.com",
          projectId: "uaqytai-ecc62",
          storageBucket: "uaqytai-ecc62.firebasestorage.app",
          messagingSenderId: "43876455640",
          appId: "1:43876455640:web:19cf47288a8cf6b3daf3ad",
          measurementId: "G-H8WFVBMEBG"
        };

        // Firebase-—Ç—ñ —ñ—Å–∫–µ “õ–æ—Å—É
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // –≠–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä
        const emailInput = document.getElementById('emailInput');
        const passInput = document.getElementById('passInput');
        const loginSection = document.getElementById('loginSection');
        const appSection = document.getElementById('appSection');
        const userInfo = document.getElementById('userInfo');
        const balanceSpan = document.getElementById('balance');
        const loader = document.getElementById('loader');
        const resultImage = document.getElementById('resultImage');
        const generateBtn = document.getElementById('generateBtn');

        // --- 1. –¢–Ü–†–ö–ï–õ–£ (–ü–æ—à—Ç–∞–º–µ–Ω) ---
        document.getElementById('registerBtn').addEventListener('click', () => {
            const email = emailInput.value;
            const pass = passInput.value;
            if(!email || !pass) return alert("–ü–æ—à—Ç–∞ –º–µ–Ω –ø–∞—Ä–æ–ª—å –∂–∞–∑—ã“£—ã–∑!");
            
            createUserWithEmailAndPassword(auth, email, pass)
                .then(async (res) => {
                    // –ñ–∞“£–∞ –∞–¥–∞–º“ì–∞ 50 —Ç–µ“£–≥–µ –±–æ–Ω—É—Å
                    await setDoc(doc(db, "users", res.user.uid), { email: email, balance: 50 });
                    alert("–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ!");
                })
                .catch(err => {
                    if(err.code === 'auth/email-already-in-use') alert("–ë“±–ª –ø–æ—à—Ç–∞ —Ç—ñ—Ä–∫–µ–ª—ñ–ø “õ–æ–π“ì–∞–Ω!");
                    else if(err.code === 'auth/weak-password') alert("–ü–∞—Ä–æ–ª—å —Ç—ã–º –æ“£–∞–π! –ö–µ–º—ñ–Ω–¥–µ 6 —Å–∏–º–≤–æ–ª –±–æ–ª—Å—ã–Ω.");
                    else alert("“ö–∞—Ç–µ: " + err.message);
                });
        });

        // --- 2. –ö–Ü–†–£ (–ü–æ—à—Ç–∞–º–µ–Ω) ---
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = emailInput.value;
            const pass = passInput.value;
            if(!email || !pass) return alert("–ü–æ—à—Ç–∞ –º–µ–Ω –ø–∞—Ä–æ–ª—å –∂–∞–∑—ã“£—ã–∑!");

            signInWithEmailAndPassword(auth, email, pass)
                .catch(() => alert("“ö–∞—Ç–µ! –ü–æ—à—Ç–∞ –Ω–µ–º–µ—Å–µ –ø–∞—Ä–æ–ª—å –¥“±—Ä—ã—Å –µ–º–µ—Å."));
        });

        // --- 3. GOOGLE –ê–†“ö–´–õ–´ –ö–Ü–†–£ ---
        document.getElementById('googleBtn').addEventListener('click', () => {
            signInWithPopup(auth, googleProvider).then(async (res) => {
                const ref = doc(db, "users", res.user.uid);
                const snap = await getDoc(ref);
                if(!snap.exists()) {
                    await setDoc(ref, { email: res.user.email, balance: 50 });
                }
            }).catch(err => console.error(err));
        });

        // --- 4. –ü–ê–†–û–õ–¨–î–Ü “∞–ú–´–¢–¢–´–ú ---
        document.getElementById('forgotBtn').addEventListener('click', () => {
            const email = emailInput.value;
            if (!email) return alert("–ñ–æ“ì–∞—Ä—ã“ì–∞ –ø–æ—à—Ç–∞“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑!");
            
            sendPasswordResetEmail(auth, email)
                .then(() => alert("–ü–æ—à—Ç–∞“£—ã–∑“ì–∞ —Å—ñ–ª—Ç–µ–º–µ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!"))
                .catch(err => alert("“ö–∞—Ç–µ: " + err.message));
        });

        // --- 5. –®–´“í–£ ---
        window.logout = () => signOut(auth);

        // --- 6. –ö“Æ–ô–î–Ü –¢–ï–ö–°–ï–†–£ ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                loginSection.style.display = 'none';
                appSection.style.display = 'block';
                userInfo.style.display = 'block';
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) balanceSpan.innerText = snap.data().balance;
                else balanceSpan.innerText = "0";
            } else {
                loginSection.style.display = 'block';
                appSection.style.display = 'none';
                userInfo.style.display = 'none';
            }
        });

        // --- 7. –°–£–†–ï–¢ –ñ–ê–°–ê–£ (–õ–û–ì–ò–ö–ê) ---
        generateBtn.addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value;
            if(!prompt) return alert("–ü—Ä–æ–º–ø—Ç –∂–∞–∑—ã“£—ã–∑!");
            
            const user = auth.currentUser;
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);
            
            if(!snap.exists() || snap.data().balance < 5) {
                alert("–ê“õ—à–∞ –∂–µ—Ç–∫—ñ–ª—ñ–∫—Å—ñ–∑! WhatsApp-“õ–∞ –∂–∞–∑—ã“£—ã–∑.");
                return;
            }

            // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—Ç—ñ ”©–∑–≥–µ—Ä—Ç—É
            generateBtn.disabled = true;
            generateBtn.innerText = "–ö“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑...";
            loader.style.display = 'block';
            resultImage.style.display = 'none';

            // –ë–∞–ª–∞–Ω—Å—Ç–∞–Ω 5 —Ç–µ“£–≥–µ –∞–ª—É
            await updateDoc(userRef, { balance: increment(-5) });
            balanceSpan.innerText = snap.data().balance - 5;

            // –£–∞“õ—ã—Ç—à–∞ —Ç–µ–≥—ñ–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ö–µ–π—ñ–Ω –æ—Å—ã –∂–µ—Ä–≥–µ –Ω–∞“ì—ã–∑ API “õ–æ—Å–∞–º—ã–∑)
            setTimeout(() => {
                const imgUrl = "https://image.pollinations.ai/prompt/" + encodeURIComponent(prompt);
                resultImage.src = imgUrl;
                resultImage.onload = () => {
                    resultImage.style.display = 'block';
                    loader.style.display = 'none';
                    generateBtn.disabled = false;
                    generateBtn.innerText = "–°—É—Ä–µ—Ç –∂–∞—Å–∞—É (5 —Ç–µ“£–≥–µ)";
                };
            }, 1000);
        });
    </script>
</body>
</html>
