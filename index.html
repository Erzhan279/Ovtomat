<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UaqytAI - iOS Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- iOS GLASSMORPHISM –°–¢–ò–õ–Ü --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(130deg, #ff7eb3, #ff758c, #4286f4, #34e89e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box; overflow: hidden;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* –ù–ï–ì–Ü–ó–ì–Ü –ö–û–ù–¢–ï–ô–ù–ï–† */
        .glass-container {
            background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-radius: 35px; border: 1px solid rgba(255, 255, 255, 0.5); padding: 30px; width: 100%; max-width: 420px; text-align: center; color: #1d1d1f;
            position: relative; z-index: 1; box-shadow: 0 20px 40px rgba(0,0,0,0.1); transition: 0.3s;
        }

        /* HEADER (–ú–µ–Ω—é –∂”ô–Ω–µ –õ–æ–≥–æ) */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; height: 40px; }
        .menu-btn { font-size: 24px; color: #007AFF; cursor: pointer; padding: 5px; transition: 0.2s; }
        .menu-btn:hover { transform: scale(1.1); }
        .logo { font-size: 24px; font-weight: 800; background: linear-gradient(to right, #007AFF, #5AC8FA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .balance-badge { background: rgba(255, 255, 255, 0.6); padding: 6px 12px; border-radius: 15px; font-weight: 700; color: #007AFF; font-size: 14px; }

        /* INPUTS & BUTTONS */
        input, textarea { width: 100%; padding: 16px; border-radius: 18px; border: none; background: rgba(255, 255, 255, 0.5); margin-bottom: 15px; box-sizing: border-box; transition: 0.3s; font-size: 16px; }
        input:focus, textarea:focus { outline: none; background: rgba(255, 255, 255, 0.9); box-shadow: 0 4px 15px rgba(0, 122, 255, 0.15); }
        
        .btn { background: linear-gradient(135deg, #007AFF, #00C6FF); color: white; border: none; padding: 16px; border-radius: 18px; font-weight: 700; width: 100%; cursor: pointer; margin-bottom: 12px; box-shadow: 0 8px 20px rgba(0, 122, 255, 0.25); transition: 0.2s; font-size: 16px; }
        .btn:active { transform: scale(0.96); }
        .btn-outline { background: transparent; border: 2px solid #007AFF; color: #007AFF; box-shadow: none; }
        .btn-google { background: white; color: #333; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* B√úYƒ∞R M”òZIR (SIDEBAR) */
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 10; display: none; opacity: 0; transition: opacity 0.3s; }
        .sidebar { 
            position: fixed; top: 0; left: -280px; width: 260px; height: 100%; 
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 11; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 30px; box-sizing: border-box; display: flex; flex-direction: column;
        }
        .sidebar.active { left: 0; }
        .sidebar-header { font-size: 22px; font-weight: bold; margin-bottom: 40px; color: #1d1d1f; }
        .sidebar-item { padding: 15px; font-size: 18px; color: #333; cursor: pointer; border-radius: 12px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; }
        .sidebar-item:hover { background: rgba(0, 122, 255, 0.1); color: #007AFF; }
        
        /* –ë–ï–¢–¢–ï–† (PAGES) */
        .page { display: none; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Welcome Page */
        .welcome-avatar { width: 80px; height: 80px; background: #ddd; border-radius: 50%; margin: 0 auto 20px; object-fit: cover; }
        .welcome-title { font-size: 26px; margin-bottom: 10px; }
        .welcome-text { color: #666; margin-bottom: 30px; }

        .divider { margin: 20px 0; color: #888; font-size: 14px; }
        #resultImage { width: 100%; border-radius: 22px; margin-top: 20px; display: none; border: 4px solid rgba(255,255,255,0.5); }
    </style>
</head>
<body>

    <div id="sidebarOverlay" class="sidebar-overlay"></div>
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">–ú–µ–Ω—é</div>
        <div class="sidebar-item"><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="sidebar-item"><i class="fas fa-wallet"></i> –ë–∞–ª–∞–Ω—Å: <span id="menuBalance" style="margin-left:5px; font-weight:bold;">0</span> ‚Ç∏</div>
        <div class="sidebar-item"><i class="fas fa-history"></i> –¢–∞—Ä–∏—Ö</div>
        <div style="flex-grow: 1;"></div> <div class="sidebar-item" onclick="logout()" style="color: #FF3B30;"><i class="fas fa-sign-out-alt"></i> –®—ã“ì—É</div>
    </div>

    <div class="glass-container">
        <div class="header">
            <div id="menuIcon" class="menu-btn" style="display: none;">
                <i class="fas fa-bars"></i>
            </div>
            
            <div class="logo">UaqytAI</div>
            
            <div id="headerBalance" style="display: none;">
                <span class="balance-badge"><span id="balance">0</span> ‚Ç∏</span>
            </div>
        </div>

        <div id="loginPage" class="page" style="display: block;">
            <h2>“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑! üëã</h2>
            <input type="email" id="emailInput" placeholder="Email (–ü–æ—à—Ç–∞)">
            <input type="password" id="passInput" placeholder="“ö“±–ø–∏—è —Å”©–∑">
            
            <div style="text-align: right; margin-bottom: 15px;">
                <span id="forgotBtn" style="color: #007AFF; font-size: 14px; cursor: pointer;">–ü–∞—Ä–æ–ª—å “±–º—ã—Ç—Ç—ã“£—ã–∑ –±–∞?</span>
            </div>
            
            <button id="loginBtn" class="btn">–ö—ñ—Ä—É</button>
            <button id="registerBtn" class="btn btn-outline">–¢—ñ—Ä–∫–µ–ª—É</button>

            <div class="divider">- –ù–ï–ú–ï–°–ï -</div>

            <button id="googleBtn" class="btn btn-google">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20" style="margin-right: 8px;">
                Google –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä—É
            </button>
        </div>

        <div id="welcomePage" class="page">
            <img id="userAvatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="welcome-avatar">
            <h2 class="welcome-title">–°”ô–ª–µ–º, <span id="userNameDisplay">–î–æ—Å</span>!</h2>
            <p class="welcome-text">–°–µ–Ω—ñ“£ —à–æ—Ç—ã“£–¥–∞ <b id="welcomeBalance">0</b> —Ç–µ“£–≥–µ –±–∞—Ä.<br>“ö–∏—è–ª—ã“£–¥–∞“ì—ã —Å—É—Ä–µ—Ç—Ç—ñ –∂–∞—Å–∞—É“ì–∞ –¥–∞–π—ã–Ω—Å—ã“£ –±–∞?</p>
            <button id="startBtn" class="btn">–ë–∞—Å—Ç–∞—É üöÄ</button>
        </div>

        <div id="appPage" class="page">
            <label style="font-weight: 600; display: block; margin-bottom: 12px; text-align: left;">–ü—Ä–æ–º–ø—Ç –∂–∞–∑—ã“£—ã–∑:</label>
            <textarea id="promptInput" placeholder="–ú—ã—Å–∞–ª—ã: “í–∞—Ä—ã—à—Ç–∞“ì—ã “õ–∞–∑–∞“õ –±–∞—Ç—ã—Ä—ã, –∫–∏–±–µ—Ä–ø–∞–Ω–∫ —Å—Ç–∏–ª—ñ, –Ω–µ–æ–Ω..."></textarea>
            
            <button id="generateBtn" class="btn">–°—É—Ä–µ—Ç –∂–∞—Å–∞—É (5 ‚Ç∏)</button>

            <div style="text-align: center;">
                <p id="loader" style="display:none; color:#007AFF; font-weight:bold; margin-top:10px;">–ñ–∞—Å–∞–Ω–¥—ã –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –æ–π–ª–∞–Ω—É–¥–∞... üß†</p>
                <img id="resultImage" src="" alt="–ù”ô—Ç–∏–∂–µ">
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBbeFirznnz99cwv1DVIroQj5ZBSM-knlY",
          authDomain: "uaqytai-ecc62.firebaseapp.com",
          projectId: "uaqytai-ecc62",
          storageBucket: "uaqytai-ecc62.firebasestorage.app",
          messagingSenderId: "43876455640",
          appId: "1:43876455640:web:19cf47288a8cf6b3daf3ad",
          measurementId: "G-H8WFVBMEBG"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // –ë–µ—Ç—Ç–µ—Ä –º–µ–Ω —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä
        const loginPage = document.getElementById('loginPage');
        const welcomePage = document.getElementById('welcomePage');
        const appPage = document.getElementById('appPage');
        const menuIcon = document.getElementById('menuIcon');
        const headerBalance = document.getElementById('headerBalance');
        
        // –ú–µ–Ω—é –ª–æ–≥–∏–∫–∞—Å—ã
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        menuIcon.addEventListener('click', () => {
            sidebar.classList.add('active');
            overlay.style.display = 'block';
            setTimeout(() => overlay.style.opacity = '1', 10);
        });

        const closeMenu = () => {
            sidebar.classList.remove('active');
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 300);
        };
        overlay.addEventListener('click', closeMenu);

        // --- –ë–ï–¢–¢–ï–†–î–Ü –ê–£–´–°–¢–´–†–£ –§–£–ù–ö–¶–ò–Ø–°–´ ---
        function showPage(pageName) {
            loginPage.style.display = 'none';
            welcomePage.style.display = 'none';
            appPage.style.display = 'none';
            
            if (pageName === 'login') {
                loginPage.style.display = 'block';
                menuIcon.style.display = 'none';
                headerBalance.style.display = 'none';
            } else if (pageName === 'welcome') {
                welcomePage.style.display = 'block';
                menuIcon.style.display = 'block';
                headerBalance.style.display = 'none'; // Welcome –±–µ—Ç—Ç–µ –±–∞–ª–∞–Ω—Å –æ—Ä—Ç–∞–¥–∞ —Ç“±—Ä
            } else if (pageName === 'app') {
                appPage.style.display = 'block';
                menuIcon.style.display = 'block';
                headerBalance.style.display = 'block';
            }
        }

        // --- AUTH LOGIC ---
        // –ö“Ø–π ”©–∑–≥–µ—Ä–≥–µ–Ω–¥–µ (–ö—ñ—Ä–≥–µ–Ω–¥–µ/–®—ã“õ“õ–∞–Ω–¥–∞)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∞–ª—É
                const snap = await getDoc(doc(db, "users", user.uid));
                let balance = 0;
                let name = user.displayName || user.email.split('@')[0];
                
                if(snap.exists()) {
                    balance = snap.data().balance;
                    // –ï–≥–µ—Ä –±–∞–∑–∞–¥–∞ –∞—Ç—ã –±–æ–ª—Å–∞, —Å–æ–Ω—ã –∞–ª–∞–º—ã–∑
                    if (snap.data().name) name = snap.data().name; 
                } else {
                    // –ñ–∞“£–∞ “õ–æ–ª–¥–∞–Ω—É—à—ã –±–æ–ª—Å–∞, —Å–∞“õ—Ç–∞–π–º—ã–∑
                    await setDoc(doc(db, "users", user.uid), { email: user.email, balance: 50 });
                    balance = 50;
                }

                // –ú”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—É
                document.getElementById('balance').innerText = balance;
                document.getElementById('menuBalance').innerText = balance;
                document.getElementById('welcomeBalance').innerText = balance;
                document.getElementById('userNameDisplay').innerText = name;
                if(user.photoURL) document.getElementById('userAvatar').src = user.photoURL;

                // Welcome –±–µ—Ç—ñ–Ω –∞—à–∞–º—ã–∑ (–ë—ñ—Ä—ñ–Ω—à—ñ —Ä–µ—Ç)
                showPage('welcome');
            } else {
                showPage('login');
            }
        });

        // Welcome –±–µ—Ç—ñ–Ω–µ–Ω "–ë–∞—Å—Ç–∞—É" –±–∞—Å“õ–∞–Ω–¥–∞
        document.getElementById('startBtn').addEventListener('click', () => {
            showPage('app');
        });

        // --- GOOGLE FIX (–¢“Æ–ó–ï–¢–Ü–õ–î–Ü) ---
        document.getElementById('googleBtn').addEventListener('click', () => {
            console.log("Google –∫–Ω–æ–ø–∫–∞—Å—ã –±–∞—Å—ã–ª–¥—ã..."); // –¢–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω
            signInWithPopup(auth, googleProvider)
                .then((result) => {
                    console.log("Google-–º–µ–Ω –∫—ñ—Ä–¥—ñ:", result.user.email);
                })
                .catch((error) => {
                    console.error("Google “õ–∞—Ç–µ—Å—ñ:", error);
                    alert("Google “õ–∞—Ç–µ—Å—ñ: " + error.message + "\n\nFirebase Console-–¥–∞ –¥–æ–º–µ–Ω–¥—ñ “õ–æ—Å—Ç—ã“£—ã–∑ –±–∞?");
                });
        });

        // --- –ü–û–®–¢–ê–ú–ï–ù –ö–Ü–†–£ ---
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            signInWithEmailAndPassword(auth, email, pass).catch(e => alert("“ö–∞—Ç–µ: " + e.message));
        });

        document.getElementById('registerBtn').addEventListener('click', () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            createUserWithEmailAndPassword(auth, email, pass).catch(e => alert("“ö–∞—Ç–µ: " + e.message));
        });

        document.getElementById('forgotBtn').addEventListener('click', () => {
            const email = document.getElementById('emailInput').value;
            if(!email) return alert("–ü–æ—à—Ç–∞–Ω—ã –∂–∞–∑—ã“£—ã–∑!");
            sendPasswordResetEmail(auth, email).then(() => alert("–°—ñ–ª—Ç–µ–º–µ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!")).catch(e => alert(e.message));
        });

        // –®–´“í–£
        window.logout = () => {
            closeMenu();
            signOut(auth);
        };

        // –°–£–†–ï–¢ –ñ–ê–°–ê–£
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value;
            if(!prompt) return alert("–ü—Ä–æ–º–ø—Ç –∂–∞–∑—ã“£—ã–∑!");
            
            const btn = document.getElementById('generateBtn');
            const loader = document.getElementById('loader');
            const img = document.getElementById('resultImage');
            
            const user = auth.currentUser;
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);

            if(snap.data().balance < 5) return alert("–ê“õ—à–∞ –∂–µ—Ç–∫—ñ–ª—ñ–∫—Å—ñ–∑!");

            // UI ”©–∑–≥–µ—Ä—Ç—É
            btn.disabled = true; 
            btn.style.opacity = "0.7";
            btn.innerText = "–ö“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑...";
            loader.style.display = 'block';
            img.style.display = 'none';

            // –ê“õ—à–∞ –∞–ª—É
            await updateDoc(userRef, { balance: increment(-5) });
            const newBal = snap.data().balance - 5;
            document.getElementById('balance').innerText = newBal;
            document.getElementById('menuBalance').innerText = newBal;

            // –°—É—Ä–µ—Ç (Pollinations)
            setTimeout(() => {
                img.src = "https://image.pollinations.ai/prompt/" + encodeURIComponent(prompt);
                img.onload = () => {
                    img.style.display = 'block';
                    loader.style.display = 'none';
                    btn.disabled = false;
                    btn.style.opacity = "1";
                    btn.innerText = "–°—É—Ä–µ—Ç –∂–∞—Å–∞—É (5 ‚Ç∏)";
                };
            }, 1000);
        });

    </script>
</body>
</html>
